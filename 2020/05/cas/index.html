<!DOCTYPE html>
<html lang="zh">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>CAS | Vtrily</title><meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="robots" content="noodp" />
<meta name="Description" content="Vtrily&#39;s Blog">
<link rel="prev" href="https://vtrily.github.io/2020/05/cas%E6%80%BB%E7%BB%93/" />
<link rel="next" href="https://vtrily.github.io/2020/05/aqs/" />
<link rel="canonical" href="https://vtrily.github.io/2020/05/cas/" />
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="CAS"/>
<meta name="twitter:description" content="CAS(æ‘˜è‡ª:https://www.jianshu.com/p/24ffe531e9ee)"/>
<script type="application/ld+json">
    {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "CAS",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https:\/\/vtrily.github.io\/2020\/05\/cas\/"
    },
    
        "image": {
            "@type": "ImageObject",
            "url": "https:\/\/vtrily.github.io\/cover.png",
            "width":  800 ,
            "height":  600 
        },
    
    "genre": "posts",
    
        "keywords": "java",
    
    "wordcount":  438 ,
    "url": "https:\/\/vtrily.github.io\/2020\/05\/cas\/",
    
        "datePublished": "2020-05-20T20:34:43\x2b08:00",
    
    
        "dateModified": "2020-05-20T20:34:43\x2b08:00",
    
    
        "license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.",
    
    
        "publisher": {
            "@type": "Organization",
            "name": "Vtrily",
            "logo": {
            "@type": "ImageObject",
            "url": "https:\/\/vtrily.github.io\/logo.png",
            "width":  127 ,
            "height":  40 
            }
        },
    
    
    "description": ""
    }
    </script>
<link rel="stylesheet" href="/css/style.min.css">
<link rel="stylesheet" href="/css/lib/fontawesome-free/all.min.min.css">

<link rel="stylesheet" href="/css/lib/animate/animate.min.min.css">

    </head>
    <body>
        <script>
            window.isDark = (window.localStorage && window.localStorage.getItem('theme')) === 'dark';
            window.isDark && document.body.classList.add('dark-theme');
        </script>
        <div class="wrapper">
            <nav class="navbar">
    <div class="navbar-container">
        <div class="navbar-header animated bounceIn">
            <a href="https://vtrily.github.io/">Vtrily</a>
        </div>
        <div class="navbar-menu">
            
            
                <a class="menu-item" href="https://vtrily.github.io/posts" title="">æ–‡ç« </a>
            
                <a class="menu-item" href="https://vtrily.github.io/tags" title="">æ ‡ç­¾</a>
            
                <a class="menu-item" href="https://vtrily.github.io/categories" title="">åˆ†ç±»</a>
            
            <a href="javascript:void(0);" class="theme-switch"><i class="fas fa-adjust fa-rotate-180 fa-fw"></i></a>
        </div>
    </div>
</nav>
<nav class="navbar-mobile">
     <div class="navbar-container">
        <div class="navbar-header">
            <div class="navbar-header-title animated bounceIn">
                <a href="https://vtrily.github.io/">Vtrily</a>
            </div>
            <div class="menu-toggle" id="menu-toggle">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="navbar-menu" id="mobile-menu">
            
            
                <a class="menu-item" href="https://vtrily.github.io/posts" title="">æ–‡ç« </a>
            
                <a class="menu-item" href="https://vtrily.github.io/tags" title="">æ ‡ç­¾</a>
            
                <a class="menu-item" href="https://vtrily.github.io/categories" title="">åˆ†ç±»</a>
            
            <a href="javascript:void(0);" class="theme-switch"><i class="fas fa-adjust fa-rotate-180 fa-fw"></i></a>
        </div>
    </div>
</nav><main class="main">
                <div class="container">
                    
    
    
    

    <article class="post-warp">
        <h1 class="post-title animated flipInX">CAS</h1>

        <div class="post-meta">
            <div class="post-meta-main">
                <a class="author" href="https://vtrily.github.io/" rel="author"><i class="fas fa-user-circle fa-fw"></i>Vtrily&nbsp;</a>
                <span class="post-category">
                        æ”¶å½•äº
                        <i class="far fa-folder fa-fw"></i><a href="https://vtrily.github.io/categories/%E6%9E%B6%E6%9E%84/">æ¶æ„</a>
                            
                    </span>
            </div>
            <div class="post-meta-other">
                <i class="far fa-calendar-alt fa-fw"></i><time datetime=2020-05-20>2020-05-20</time>&nbsp;
                <i class="fas fa-pencil-alt fa-fw"></i>çº¦ 438 å­—&nbsp;
                <i class="far fa-clock fa-fw"></i>é¢„è®¡é˜…è¯» 3 åˆ†é’Ÿ&nbsp;</div>
        </div>

        

        

        <div class="post-content">
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            <p>CAS(æ‘˜è‡ª:https://www.jianshu.com/p/24ffe531e9ee)</p>
<a class="post-dummy-target" id="heading"></a><h3>å‰è¨€</h3>
<p>CASï¼ˆCompare and Swapï¼‰ï¼Œå³æ¯”è¾ƒå¹¶æ›¿æ¢ï¼Œå®ç°å¹¶å‘ç®—æ³•æ—¶å¸¸ç”¨åˆ°çš„ä¸€ç§æŠ€æœ¯ï¼ŒDoug leaå¤§ç¥åœ¨javaåŒæ­¥å™¨ä¸­å¤§é‡ä½¿ç”¨äº†CASæŠ€æœ¯ï¼Œé¬¼æ–§ç¥å·¥çš„å®ç°äº†å¤šçº¿ç¨‹æ‰§è¡Œçš„å®‰å…¨æ€§ã€‚</p>
<p>CASçš„æ€æƒ³å¾ˆç®€å•ï¼šä¸‰ä¸ªå‚æ•°ï¼Œä¸€ä¸ªå½“å‰å†…å­˜å€¼Vã€æ—§çš„é¢„æœŸå€¼Aã€å³å°†æ›´æ–°çš„å€¼Bï¼Œå½“ä¸”ä»…å½“é¢„æœŸå€¼Aå’Œå†…å­˜å€¼Vç›¸åŒæ—¶ï¼Œå°†å†…å­˜å€¼ä¿®æ”¹ä¸ºBå¹¶è¿”å›trueï¼Œå¦åˆ™ä»€ä¹ˆéƒ½ä¸åšï¼Œå¹¶è¿”å›falseã€‚</p>
<a class="post-dummy-target" id="heading1"></a><h3>é—®é¢˜</h3>
<p>ä¸€ä¸ªn++çš„é—®é¢˜ã€‚</p>
<pre><code>public class Case {

    public volatile int n;

    public void add() {
        n++;
    }
}
</code></pre><p>é€šè¿‡javap -verbose Caseçœ‹çœ‹addæ–¹æ³•çš„å­—èŠ‚ç æŒ‡ä»¤</p>
<pre><code>public void add();
    flags: ACC_PUBLIC
    Code:
      stack=3, locals=1, args_size=1
         0: aload_0       
         1: dup           
         2: getfield      #2                  // Field n:I
         5: iconst_1      
         6: iadd          
         7: putfield      #2                  // Field n:I
        10: return        
</code></pre><p>n++è¢«æ‹†åˆ†æˆäº†å‡ ä¸ªæŒ‡ä»¤ï¼š</p>
<p>æ‰§è¡Œgetfieldæ‹¿åˆ°åŸå§‹nï¼›
æ‰§è¡Œiaddè¿›è¡ŒåŠ 1æ“ä½œï¼›
æ‰§è¡Œputfieldå†™æŠŠç´¯åŠ åçš„å€¼å†™å›nï¼›
é€šè¿‡volatileä¿®é¥°çš„å˜é‡å¯ä»¥ä¿è¯çº¿ç¨‹ä¹‹é—´çš„å¯è§æ€§ï¼Œä½†å¹¶ä¸èƒ½ä¿è¯è¿™3ä¸ªæŒ‡ä»¤çš„åŸå­æ‰§è¡Œï¼Œåœ¨å¤šçº¿ç¨‹å¹¶å‘æ‰§è¡Œä¸‹ï¼Œæ— æ³•åšåˆ°çº¿ç¨‹å®‰å…¨ï¼Œå¾—åˆ°æ­£ç¡®çš„ç»“æœï¼Œé‚£ä¹ˆåº”è¯¥å¦‚ä½•è§£å†³å‘¢ï¼Ÿ</p>
<a class="post-dummy-target" id="heading2"></a><h4>å¦‚ä½•è§£å†³</h4>
<p>åœ¨addæ–¹æ³•åŠ ä¸Šsynchronizedä¿®é¥°è§£å†³ã€‚</p>
<pre><code>public class Case {

    public volatile int n;

    public synchronized void add() {
        n++;
    }
}
</code></pre><p>è¿™ä¸ªæ–¹æ¡ˆå½“ç„¶å¯è¡Œï¼Œä½†æ˜¯æ€§èƒ½ä¸Šå·®äº†ç‚¹ï¼Œè¿˜æœ‰å…¶å®ƒæ–¹æ¡ˆä¹ˆï¼Ÿ</p>
<p>å†æ¥çœ‹ä¸€æ®µä»£ç </p>
<pre><code>public int a = 1;
public boolean compareAndSwapInt(int b) {
    if (a == 1) {
        a = b;
        return true;
    }
    return false;
}
</code></pre><p>å¦‚æœè¿™æ®µä»£ç åœ¨å¹¶å‘ä¸‹æ‰§è¡Œï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p>
<p>å‡è®¾çº¿ç¨‹1å’Œçº¿ç¨‹2éƒ½è¿‡äº†a==1çš„æ£€æµ‹ï¼Œéƒ½å‡†å¤‡æ‰§è¡Œå¯¹aè¿›è¡Œèµ‹å€¼ï¼Œç»“æœå°±æ˜¯ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶ä¿®æ”¹äº†å˜é‡aï¼Œæ˜¾ç„¶è¿™ç§ç»“æœæ˜¯æ— æ³•ç¬¦åˆé¢„æœŸçš„ï¼Œæ— æ³•ç¡®å®šaçš„æœ€ç»ˆå€¼ã€‚</p>
<p>è§£å†³æ–¹æ³•ä¹ŸåŒæ ·æš´åŠ›ï¼Œåœ¨compareAndSwapIntæ–¹æ³•åŠ é”åŒæ­¥ï¼Œå˜æˆä¸€ä¸ªåŸå­æ“ä½œï¼ŒåŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰èƒ½ä¿®æ”¹å˜é‡aã€‚</p>
<p>é™¤äº†ä½æ€§èƒ½çš„åŠ é”æ–¹æ¡ˆï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨JDKè‡ªå¸¦çš„CASæ–¹æ¡ˆï¼Œåœ¨CASä¸­ï¼Œæ¯”è¾ƒå’Œæ›¿æ¢æ˜¯ä¸€ç»„åŸå­æ“ä½œï¼Œä¸ä¼šè¢«å¤–éƒ¨æ‰“æ–­ï¼Œä¸”åœ¨æ€§èƒ½ä¸Šæ›´å æœ‰ä¼˜åŠ¿ã€‚</p>
<p>ä¸‹é¢ä»¥AtomicIntegerçš„å®ç°ä¸ºä¾‹ï¼Œåˆ†æä¸€ä¸‹CASæ˜¯å¦‚ä½•å®ç°çš„ã€‚</p>
<pre><code>public class AtomicInteger extends Number implements java.io.Serializable {
    // setup to use Unsafe.compareAndSwapInt for updates
    private static final Unsafe unsafe = Unsafe.getUnsafe();
    private static final long valueOffset;

    static {
        try {
            valueOffset = unsafe.objectFieldOffset
                (AtomicInteger.class.getDeclaredField(&quot;value&quot;));
        } catch (Exception ex) { throw new Error(ex); }
    }

    private volatile int value;
    public final int get() {return value;}
}
</code></pre><p>Unsafeï¼Œæ˜¯CASçš„æ ¸å¿ƒç±»ï¼Œç”±äºJavaæ–¹æ³•æ— æ³•ç›´æ¥è®¿é—®åº•å±‚ç³»ç»Ÿï¼Œéœ€è¦é€šè¿‡æœ¬åœ°ï¼ˆnativeï¼‰æ–¹æ³•æ¥è®¿é—®ï¼ŒUnsafeç›¸å½“äºä¸€ä¸ªåé—¨ï¼ŒåŸºäºè¯¥ç±»å¯ä»¥ç›´æ¥æ“ä½œç‰¹å®šå†…å­˜çš„æ•°æ®ã€‚
å˜é‡valueOffsetï¼Œè¡¨ç¤ºè¯¥å˜é‡å€¼åœ¨å†…å­˜ä¸­çš„åç§»åœ°å€ï¼Œå› ä¸ºUnsafeå°±æ˜¯æ ¹æ®å†…å­˜åç§»åœ°å€è·å–æ•°æ®çš„ã€‚
å˜é‡valueç”¨volatileä¿®é¥°ï¼Œä¿è¯äº†å¤šçº¿ç¨‹ä¹‹é—´çš„å†…å­˜å¯è§æ€§ã€‚
çœ‹çœ‹AtomicIntegerå¦‚ä½•å®ç°å¹¶å‘ä¸‹çš„ç´¯åŠ æ“ä½œï¼š</p>
<pre><code>public final int getAndAdd(int delta) {    
    return unsafe.getAndAddInt(this, valueOffset, delta);
}

//unsafe.getAndAddInt
public final int getAndAddInt(Object var1, long var2, int var4) {
    int var5;
    do {
        var5 = this.getIntVolatile(var1, var2);
    } while(!this.compareAndSwapInt(var1, var2, var5, var5 + var4));
    return var5;
}
</code></pre><p>å‡è®¾çº¿ç¨‹Aå’Œçº¿ç¨‹BåŒæ—¶æ‰§è¡ŒgetAndAddæ“ä½œï¼ˆåˆ†åˆ«è·‘åœ¨ä¸åŒCPUä¸Šï¼‰ï¼š</p>
<p>AtomicIntegeré‡Œé¢çš„valueåŸå§‹å€¼ä¸º3ï¼Œå³ä¸»å†…å­˜ä¸­AtomicIntegerçš„valueä¸º3ï¼Œæ ¹æ®Javaå†…å­˜æ¨¡å‹ï¼Œçº¿ç¨‹Aå’Œçº¿ç¨‹Bå„è‡ªæŒæœ‰ä¸€ä»½valueçš„å‰¯æœ¬ï¼Œå€¼ä¸º3ã€‚
çº¿ç¨‹Aé€šè¿‡getIntVolatile(var1, var2)æ‹¿åˆ°valueå€¼3ï¼Œè¿™æ—¶çº¿ç¨‹Aè¢«æŒ‚èµ·ã€‚
çº¿ç¨‹Bä¹Ÿé€šè¿‡getIntVolatile(var1, var2)æ–¹æ³•è·å–åˆ°valueå€¼3ï¼Œè¿æ°”å¥½ï¼Œçº¿ç¨‹Bæ²¡æœ‰è¢«æŒ‚èµ·ï¼Œå¹¶æ‰§è¡ŒcompareAndSwapIntæ–¹æ³•æ¯”è¾ƒå†…å­˜å€¼ä¹Ÿä¸º3ï¼ŒæˆåŠŸä¿®æ”¹å†…å­˜å€¼ä¸º2ã€‚
è¿™æ—¶çº¿ç¨‹Aæ¢å¤ï¼Œæ‰§è¡ŒcompareAndSwapIntæ–¹æ³•æ¯”è¾ƒï¼Œå‘ç°è‡ªå·±æ‰‹é‡Œçš„å€¼(3)å’Œå†…å­˜çš„å€¼(2)ä¸ä¸€è‡´ï¼Œè¯´æ˜è¯¥å€¼å·²ç»è¢«å…¶å®ƒçº¿ç¨‹æå‰ä¿®æ”¹è¿‡äº†ï¼Œé‚£åªèƒ½é‡æ–°æ¥ä¸€éäº†ã€‚
é‡æ–°è·å–valueå€¼ï¼Œå› ä¸ºå˜é‡valueè¢«volatileä¿®é¥°ï¼Œæ‰€ä»¥å…¶å®ƒçº¿ç¨‹å¯¹å®ƒçš„ä¿®æ”¹ï¼Œçº¿ç¨‹Aæ€»æ˜¯èƒ½å¤Ÿçœ‹åˆ°ï¼Œçº¿ç¨‹Aç»§ç»­æ‰§è¡ŒcompareAndSwapIntè¿›è¡Œæ¯”è¾ƒæ›¿æ¢ï¼Œç›´åˆ°æˆåŠŸã€‚
æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œåˆ©ç”¨CASä¿è¯äº†å¯¹äºvalueçš„ä¿®æ”¹çš„å¹¶å‘å®‰å…¨ï¼Œç»§ç»­æ·±å…¥çœ‹çœ‹Unsafeç±»ä¸­çš„compareAndSwapIntæ–¹æ³•å®ç°ã€‚</p>
<pre><code>public final native boolean compareAndSwapInt(Object paramObject, long paramLong, int paramInt1, int paramInt2);
</code></pre><p>Unsafeç±»ä¸­çš„compareAndSwapIntï¼Œæ˜¯ä¸€ä¸ªæœ¬åœ°æ–¹æ³•ï¼Œè¯¥æ–¹æ³•çš„å®ç°ä½äºunsafe.cppä¸­</p>
<pre><code>UNSAFE_ENTRY(jboolean, Unsafe_CompareAndSwapInt(JNIEnv *env, jobject unsafe, jobject obj, jlong offset, jint e, jint x))
  UnsafeWrapper(&quot;Unsafe_CompareAndSwapInt&quot;);
  oop p = JNIHandles::resolve(obj);
  jint* addr = (jint *) index_oop_from_field_offset_long(p, offset);
  return (jint)(Atomic::cmpxchg(x, addr, e)) == e;
UNSAFE_END
</code></pre><p>å…ˆæƒ³åŠæ³•æ‹¿åˆ°å˜é‡valueåœ¨å†…å­˜ä¸­çš„åœ°å€ã€‚
é€šè¿‡Atomic::cmpxchgå®ç°æ¯”è¾ƒæ›¿æ¢ï¼Œå…¶ä¸­å‚æ•°xæ˜¯å³å°†æ›´æ–°çš„å€¼ï¼Œå‚æ•°eæ˜¯åŸå†…å­˜çš„å€¼ã€‚
å¦‚æœæ˜¯Linuxçš„x86ï¼ŒAtomic::cmpxchgæ–¹æ³•çš„å®ç°å¦‚ä¸‹ï¼š</p>
<pre><code>inline jint Atomic::cmpxchg (jint exchange_value, volatile jint* dest, jint compare_value) {
  int mp = os::is_MP();
  __asm__ volatile (LOCK_IF_MP(%4) &quot;cmpxchgl %1,(%3)&quot;
                    : &quot;=a&quot; (exchange_value)
                    : &quot;r&quot; (exchange_value), &quot;a&quot; (compare_value), &quot;r&quot; (dest), &quot;r&quot; (mp)
                    : &quot;cc&quot;, &quot;memory&quot;);
  return exchange_value;
}
</code></pre><p>çœ‹åˆ°è¿™æ±‡ç¼–ï¼Œå†…å¿ƒå´©æºƒ ğŸ˜–</p>
<p>__asm__è¡¨ç¤ºæ±‡ç¼–çš„å¼€å§‹
volatileè¡¨ç¤ºç¦æ­¢ç¼–è¯‘å™¨ä¼˜åŒ–
LOCK_IF_MPæ˜¯ä¸ªå†…è”å‡½æ•°</p>
<pre><code>#define LOCK_IF_MP(mp) &quot;cmp $0, &quot; #mp &quot;; je 1f; lock; 1: &quot;
</code></pre><p>Windowçš„x86å®ç°å¦‚ä¸‹ï¼š</p>
<pre><code>inline jint Atomic::cmpxchg (jint exchange_value, volatile jint* dest, jint compare_value) {
    int mp = os::isMP(); //åˆ¤æ–­æ˜¯å¦æ˜¯å¤šå¤„ç†å™¨
    _asm {
        mov edx, dest
        mov ecx, exchange_value
        mov eax, compare_value
        LOCK_IF_MP(mp)
        cmpxchg dword ptr [edx], ecx
    }
}

// Adding a lock prefix to an instruction on MP machine
// VC++ doesn't like the lock prefix to be on a single line
// so we can't insert a label after the lock prefix.
// By emitting a lock prefix, we can define a label after it.
#define LOCK_IF_MP(mp) __asm cmp mp, 0  \
                       __asm je L0      \
                       __asm _emit 0xF0 \
                       __asm L0:
</code></pre><p>LOCK_IF_MPæ ¹æ®å½“å‰ç³»ç»Ÿæ˜¯å¦ä¸ºå¤šæ ¸å¤„ç†å™¨å†³å®šæ˜¯å¦ä¸ºcmpxchgæŒ‡ä»¤æ·»åŠ lockå‰ç¼€ã€‚</p>
<p>å¦‚æœæ˜¯å¤šå¤„ç†å™¨ï¼Œä¸ºcmpxchgæŒ‡ä»¤æ·»åŠ lockå‰ç¼€ã€‚
åä¹‹ï¼Œå°±çœç•¥lockå‰ç¼€ã€‚ï¼ˆå•å¤„ç†å™¨ä¼šä¸éœ€è¦lockå‰ç¼€æä¾›çš„å†…å­˜å±éšœæ•ˆæœï¼‰
intelæ‰‹å†Œå¯¹lockå‰ç¼€çš„è¯´æ˜å¦‚ä¸‹ï¼š</p>
<p>ç¡®ä¿åç»­æŒ‡ä»¤æ‰§è¡Œçš„åŸå­æ€§ã€‚
åœ¨PentiumåŠä¹‹å‰çš„å¤„ç†å™¨ä¸­ï¼Œå¸¦æœ‰lockå‰ç¼€çš„æŒ‡ä»¤åœ¨æ‰§è¡ŒæœŸé—´ä¼šé”ä½æ€»çº¿ï¼Œä½¿å¾—å…¶å®ƒå¤„ç†å™¨æš‚æ—¶æ— æ³•é€šè¿‡æ€»çº¿è®¿é—®å†…å­˜ï¼Œå¾ˆæ˜¾ç„¶ï¼Œè¿™ä¸ªå¼€é”€å¾ˆå¤§ã€‚åœ¨æ–°çš„å¤„ç†å™¨ä¸­ï¼ŒIntelä½¿ç”¨ç¼“å­˜é”å®šæ¥ä¿è¯æŒ‡ä»¤æ‰§è¡Œçš„åŸå­æ€§ï¼Œç¼“å­˜é”å®šå°†å¤§å¤§é™ä½lockå‰ç¼€æŒ‡ä»¤çš„æ‰§è¡Œå¼€é”€ã€‚
ç¦æ­¢è¯¥æŒ‡ä»¤ä¸å‰é¢å’Œåé¢çš„è¯»å†™æŒ‡ä»¤é‡æ’åºã€‚
æŠŠå†™ç¼“å†²åŒºçš„æ‰€æœ‰æ•°æ®åˆ·æ–°åˆ°å†…å­˜ä¸­ã€‚
ä¸Šé¢çš„ç¬¬2ç‚¹å’Œç¬¬3ç‚¹æ‰€å…·æœ‰çš„å†…å­˜å±éšœæ•ˆæœï¼Œä¿è¯äº†CASåŒæ—¶å…·æœ‰volatileè¯»å’Œvolatileå†™çš„å†…å­˜è¯­ä¹‰ã€‚</p>
<p>CASç¼ºç‚¹
CASå­˜åœ¨ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„é—®é¢˜ï¼Œå³ABAé—®é¢˜ã€‚</p>
<p>é—®é¢˜ï¼šå¦‚æœå˜é‡Våˆæ¬¡è¯»å–çš„æ—¶å€™æ˜¯Aï¼Œå¹¶ä¸”åœ¨å‡†å¤‡èµ‹å€¼çš„æ—¶å€™æ£€æŸ¥åˆ°å®ƒä»ç„¶æ˜¯Aï¼Œé‚£èƒ½è¯´æ˜å®ƒçš„å€¼æ²¡æœ‰è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹è¿‡äº†å—ï¼Ÿ</p>
<p>å¦‚æœåœ¨è¿™æ®µæœŸé—´æ›¾ç»è¢«æ”¹æˆBï¼Œç„¶ååˆæ”¹å›Aï¼Œé‚£CASæ“ä½œå°±ä¼šè¯¯è®¤ä¸ºå®ƒä»æ¥æ²¡æœ‰è¢«ä¿®æ”¹è¿‡ã€‚é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œjavaå¹¶å‘åŒ…ä¸­æä¾›äº†ä¸€ä¸ªå¸¦æœ‰æ ‡è®°çš„åŸå­å¼•ç”¨ç±»AtomicStampedReferenceï¼Œå®ƒå¯ä»¥é€šè¿‡æ§åˆ¶å˜é‡å€¼çš„ç‰ˆæœ¬æ¥ä¿è¯CASçš„æ­£ç¡®æ€§</p>
        </div>

        <div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>æœ¬æ–‡äº 2020-05-20 æ›´æ–°</span>
            </div>
            <div class="post-info-license">
                
            </div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md">
                
            </div>
            <div class="post-info-share">
                
                    <span></span>
                
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section>
            
                
                    <span class="tag">
                        <a href="https://vtrily.github.io/tags/java/"><i class="fas fa-tag fa-fw"></i>java</a>
                    </span>
                
            
        </section>
        <section>
            <span><a href="javascript:window.history.back();">è¿”å›</a></span>&nbsp;|&nbsp;<span><a href="https://vtrily.github.io/">ä¸»é¡µ</a></span>
        </section>
    </div>

    <div class="post-nav">
        
            <a href="https://vtrily.github.io/2020/05/cas%E6%80%BB%E7%BB%93/" class="prev" rel="prev" title="CAS"><i class="fas fa-angle-left fa-fw"></i>CAS</a>
        
        
            <a href="https://vtrily.github.io/2020/05/aqs/" class="next" rel="next" title="AQS">AQS<i class="fas fa-angle-right fa-fw"></i></a>
        
    </div>
</div>

        <div class="post-comment">
            
            

            
        </div>
    </article></div>
            </main>
            <footer class="footer">
    <div class="copyright">
        <div class="copyright-line">
            ç”± <a href="https://gohugo.io/" target="_blank" rel="external nofollow noopener noreffer">Hugo</a> å¼ºåŠ›é©±åŠ¨&nbsp;|&nbsp;ä¸»é¢˜ - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="external nofollow noopener noreffer">LoveIt<i class="far fa-heart fa-fw"></i></a>
        </div>
        <div class="copyright-line">
            <i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2019 - 2020</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://vtrily.github.io/">Vtrily</a></span><span class="license">&nbsp;|&nbsp;<a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
    </div>
</footer>


    
    




    
    




    
    





    
    



    
    



    
    





    
    





    
    



    
    





    
    




    
    




    
    



    
    





    
    


<script src="/js/lib/jquery/jquery.slim.min.min.js"></script>
<script src="/js/lib/lazysizes/lazysizes.min.min.js"></script>
<script src="/js/lib/smooth-scroll/smooth-scroll.polyfills.min.min.js"></script><script>window.scroll = new SmoothScroll('[data-scroll]', {speed: 300, speedAsDuration: true});</script>


    
    

    

    

    

    






<script src="/js/blog.min.js"></script>


    
</div>
        <a href="#" class="dynamic-to-top" id="dynamic-to-top" data-scroll><span>&nbsp;</span></a>
    </body>
</html>