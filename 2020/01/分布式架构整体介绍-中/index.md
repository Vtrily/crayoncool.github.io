# 分布式架构整体介绍-中


# 分布式系统架构技术选型

- 服务网关
- 监控平台
- RPC框架
- 监控中心
- 注册中心
- 消息队列
- 配置中心

## 服务网关

系统的唯一入口，封装了系统内部架构，为客户端提供服务

### 服务网关功能

- 统一接入
- 用户鉴权
- 过滤请求
- 协议适配
- 路由转发

BIO，NIO,AIO底层比较分析

### 服务网关实现

- web框架
- 过滤拦截
- RPC客户端

## 监控平台选择

- 被动监控和主动监控

被动监控，主动触发客户端执行脚本，会存在大量的磁盘IO，占用服务器资源

主动监控： 客户端进行埋点只做计数，收集数据

### 核心功能

- 数据采集

- 数据上报

- 数据展示

- 告警

## RPC框架选型

主要考虑维度

- 语言
- 框架特性
- 成熟度
- 技术支持
- 社区活跃度

## 注册中心选型

主要考虑维度

- 数据模型
- 数据一致性
- 健康检查
- 性能与容量
- 易用性
- 扩展性

## 消息队列选择

主要考虑维度

- 系统定位
- 支持功能
- 可用性
- 可靠性
- 运维

## 配置中心选择

主要考虑维度

- 配置存储
- 本地缓存
- 配置生效时间
- 权限管理
- 审计
- 配置版本管理
- 灰度发布
- 配置更新推送
- 配置定时拉取
- 配置项维护
- 多环境
- 社区活跃度


## <font color=#DC143C>分布式锁的续租问题如何解决？</font>

锁的时间锁多长时间合适？

默认10s

选CP还是AP?


架构演进

从无到有，从有到平台化，好用

## 分布式系统高可用架构设计

- 请求生命周期分析（请求链路分析）
- 服务冗余
- 存储冗余
- 模块拆分（业务解耦）

### <font color=#DC143C>请求生命周期</font>

DNS-> LVS -> NG -> CDN -> 网关 -> 业务逻辑 -> 数据访问 -> 存储

<font color=#DC143C>四层负载和七层负载</font>


### 服务冗余

- 服务注册于发现
- 连接管理
- 负载均衡、路由
- 健康检查
- 节点探活
- 失效处理

入口高可用设计

DNS
LVS
NG

部署多台LVS和NG

### 存储冗余

主要保证数据的高可靠

#### 主从部署

- 一主一从或多从
优点：
缺点：同步压力大
- 级联部署
优点：主挂了，不影响同步
缺点：中间节点结了之后会有影响，同步的可靠性不是很好，依赖上游

- 延迟库部署
一主多从
级联部署延迟从做备份

- 主从切换

从节点提升为主，主恢复后，作为从节点

虚IP部署方案

### 数据隔离

不同业务不同数据库，防止互相影响

### 模块拆分

拆分原则

- 职责单一
- 业务隔离
- 粒度合理
- 结合场景
- 适应组织架构
- 避免循环依赖